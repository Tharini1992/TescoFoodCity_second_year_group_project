<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delivery Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    body { display: flex; flex-direction: column; min-height: 100vh; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; }
    main { flex: 1; }
    .navbar { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .nav-link { color: #333 !important; font-weight: 600; }
    .nav-link:hover { color: #43a047 !important; }
    .table th, .table td { vertical-align: middle; }
    .status-select { border-radius: 5px; padding: 4px 8px; }
    footer { background: #2e7d32; color: white; padding: 30px 20px; }
    .footer-content { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 30px; }
    .footer-content h5 { margin-bottom: 10px; }
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <header>
    <nav class="navbar navbar-expand-lg navbar-light bg-white px-4 py-3">
      <a class="navbar-brand" href="#">
        <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="Logo" width="50">
      </a>

      <div class="collapse navbar-collapse justify-content-end">
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="accountDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fa-solid fa-user me-1"></i>{{ username }}
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="accountDropdown">
              <li><a class="dropdown-item" href="#">Account Settings</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}"><i class="fa-solid fa-right-from-bracket me-1"></i> Logout</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>
  </header>

  <!-- MAIN -->
  <main class="container mt-4">
    <p class="mb-4">Welcome, <strong>{{ username }}</strong></p>

    <div class="card shadow-sm mb-4">
      <div class="card-header bg-success text-white">
        <i class="fa-solid fa-truck"></i> Manage Orders
      </div>
      <div class="card-body">
        <div class="form-inline mb-3">
          <input type="text" id="orderId" placeholder="Order ID" class="form-control me-2">
          <input type="text" id="userEmail" placeholder="User Email" class="form-control me-2">
          <input type="text" id="total" placeholder="Total" class="form-control me-2">
          <select id="status" class="form-select me-2" style="width:auto;">
            <option value="Pending">Pending</option>
            <option value="In Transit">In Transit</option>
            <option value="Delivered">Delivered</option>
          </select>
          <button class="btn btn-success btn-sm me-2" onclick="addOrder()">Add Order</button>
          <button class="btn btn-danger btn-sm" onclick="removeSelected()">Remove Selected</button>
        </div>

        <div class="table-responsive">
          <table class="table table-striped align-middle" id="ordersTable">
            <thead class="table-dark">
              <tr>
                <th>Select</th>
                <th>Order ID</th>
                <th>User</th>
                <th>Total</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><input type="checkbox"></td>
                <td>101</td>
                <td>alice@example.com</td>
                <td>$25.00</td>
                <td>
                  <select class="status-select" onchange="updateStatus(this)">
                    <option value="Pending" selected>Pending</option>
                    <option value="In Transit">In Transit</option>
                    <option value="Delivered">Delivered</option>
                  </select>
                </td>
                <td>
                  <button class="btn btn-success btn-sm" onclick="confirmDelivery(this)">
                    <i class="fa-solid fa-check"></i> Confirm
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="openIssueModal(this)">
                    <i class="fa-solid fa-triangle-exclamation"></i> Issue
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- ISSUE MODAL -->
  <div class="modal fade" id="issueModal" tabindex="-1" aria-labelledby="issueModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-warning text-dark">
          <h5 class="modal-title" id="issueModalLabel">Report Delivery Issue</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="issueOrderInfo"></p>
          <textarea id="issueDescription" class="form-control" placeholder="Describe the issue..." rows="3"></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger btn-sm" onclick="submitIssue()">Submit Issue</button>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="footer-content">
      <div>
        <h5>Tesco Food City</h5>
        <p>Crafting exceptional shopping experiences for our valued customers.</p>
      </div>
      <div>
        <h5>Contact Us</h5>
        <p>üìç 380/F Leyland Junction, Panagoda Homagama</p>
        <p>üìû 0773659784</p>
        <p>üìß TescoFoodCity@gmail.com</p>
      </div>
      <div>
        <h5>Quick Links</h5>
        <p>About</p>
        <p>Privacy Policy</p>
        <p>Return Policy</p>
        <p>Shipping Info</p>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let currentIssueRow = null;

    function addOrder() {
      const orderId = document.getElementById('orderId').value;
      const userEmail = document.getElementById('userEmail').value;
      const total = document.getElementById('total').value;
      const status = document.getElementById('status').value;

      if(orderId && userEmail && total) {
        const table = document.getElementById('ordersTable').getElementsByTagName('tbody')[0];
        const row = table.insertRow();
        row.innerHTML = `
          <td><input type="checkbox"></td>
          <td>${orderId}</td>
          <td>${userEmail}</td>
          <td>${total}</td>
          <td>
            <select class="status-select" onchange="updateStatus(this)">
              <option value="Pending" ${status=='Pending'?'selected':''}>Pending</option>
              <option value="In Transit" ${status=='In Transit'?'selected':''}>In Transit</option>
              <option value="Delivered" ${status=='Delivered'?'selected':''}>Delivered</option>
            </select>
          </td>
          <td>
            <button class="btn btn-success btn-sm" onclick="confirmDelivery(this)">
              <i class="fa-solid fa-check"></i> Confirm
            </button>
            <button class="btn btn-danger btn-sm" onclick="openIssueModal(this)">
              <i class="fa-solid fa-triangle-exclamation"></i> Issue
            </button>
          </td>
        `;
        document.getElementById('orderId').value = '';
        document.getElementById('userEmail').value = '';
        document.getElementById('total').value = '';
        document.getElementById('status').value = 'Pending';
      } else {
        alert('Please fill all fields.');
      }
    }

    function removeSelected() {
      const table = document.getElementById('ordersTable').getElementsByTagName('tbody')[0];
      for(let i = table.rows.length-1; i>=0; i--) {
        const row = table.rows[i];
        const checkbox = row.cells[0].children[0];
        if(checkbox.checked) table.deleteRow(i);
      }
    }

    function updateStatus(select) {
      alert(`Status updated to: ${select.value}`);
    }

    function confirmDelivery(button) {
      const row = button.closest('tr');
      row.querySelector('.status-select').value = 'Delivered';
      alert(`Order ${row.cells[1].innerText} marked as Delivered`);
    }

    function openIssueModal(button) {
      currentIssueRow = button.closest('tr');
      document.getElementById('issueOrderInfo').innerText = `Order ID: ${currentIssueRow.cells[1].innerText}, User: ${currentIssueRow.cells[2].innerText}`;
      document.getElementById('issueDescription').value = '';
      const modal = new bootstrap.Modal(document.getElementById('issueModal'));
      modal.show();
    }

    function submitIssue() {
      const description = document.getElementById('issueDescription').value;
      if(description.trim() === '') {
        alert('Please describe the issue.');
        return;
      }
      currentIssueRow.querySelector('.status-select').value = 'Issue Reported';
      alert(`Issue reported for Order ${currentIssueRow.cells[1].innerText}:\n${description}`);
      const modalEl = document.getElementById('issueModal');
      const modal = bootstrap.Modal.getInstance(modalEl);
      modal.hide();
    }
  </script>
</body>
</html>
