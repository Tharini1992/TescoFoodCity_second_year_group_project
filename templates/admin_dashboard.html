<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Portal | Tesco Food City</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    :root {
        --primary-color: #00539f; /* Tesco Blue */
        --sidebar-bg: #ffffff;
        --sidebar-text: #64748b;
        --sidebar-active: #00539f; 
        --bg-light: #f3f4f6;
    }
    body { font-family: 'Inter', sans-serif; background-color: var(--bg-light); display: flex; min-height: 100vh;}
    
    /* SIDEBAR */
    .sidebar { 
        width: 260px; 
        height: 100vh; 
        background: var(--sidebar-bg); 
        color: #333; 
        position: fixed; 
        display: flex; 
        flex-direction: column; 
        padding: 20px; 
        transition: 0.3s; 
        z-index: 1000;
        border-right: 1px solid #e2e8f0; 
    }
    .sidebar h4 { 
        font-weight: 700; 
        color: #0f172a; 
        margin-bottom: 40px; 
        letter-spacing: 0.5px;
        display: flex;       /* Added for logo alignment */
        align-items: center; /* Added for logo alignment */
    }
    .nav-link { 
        color: var(--sidebar-text); 
        padding: 12px 15px; 
        border-radius: 8px; 
        margin-bottom: 5px; 
        transition: 0.2s; 
        font-size: 0.95rem; 
        font-weight: 500;
    }
    .nav-link:hover { 
        background: #f1f5f9; 
        color: var(--primary-color); 
        transform: translateX(5px); 
    }
    .nav-link.active { 
        background: #eff6ff; 
        color: var(--primary-color); 
        font-weight: 600;
    }
    .nav-link i { margin-right: 12px; font-size: 1.1rem; }
    
    /* MAIN CONTENT */
    .main-content { 
        margin-left: 260px; 
        width: calc(100% - 260px); 
        padding: 30px; 
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }
    
    /* STAT CARDS */
    .stat-card { background: #fff; border: none; border-radius: 12px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); display: flex; align-items: center; justify-content: space-between; transition: 0.3s; }
    .stat-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.06); }
    .stat-icon { width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
    .bg-blue-light { background: #e0f2fe; color: #0284c7; }
    .bg-green-light { background: #dcfce7; color: #16a34a; }
    .bg-purple-light { background: #f3e8ff; color: #9333ea; }
    .bg-orange-light { background: #ffedd5; color: #ea580c; }

    /* TABLES */
    .table-container { background: #fff; border-radius: 12px; padding: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); margin-top: 30px; }
    .table thead th { font-weight: 600; color: #64748b; border-bottom: 2px solid #f1f5f9; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; }
    .table tbody td { padding: 15px 10px; vertical-align: middle; color: #334155; font-size: 0.95rem; }
    .table-hover tbody tr:hover { background-color: #f8fafc; }
    
    /* BADGES */
    .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
    .status-pending { background: #fff7ed; color: #c2410c; border: 1px solid #ffedd5; }
    .status-completed { background: #f0fdf4; color: #15803d; border: 1px solid #dcfce7; }
    .status-cancelled { background: #fef2f2; color: #b91c1c; border: 1px solid #fee2e2; }

    /* BUTTONS */
    .btn-primary-custom { background: var(--primary-color); border: none; padding: 10px 20px; border-radius: 8px; font-weight: 500; }
    .btn-primary-custom:hover { background: #004485; }

    /* FOOTER STYLES */
    .admin-footer {
        background-color: #15803d; 
        color: white;
        margin-top: auto; 
        padding: 40px 0 20px 0;
        border-radius: 12px 12px 0 0;
        margin-top: 50px;
    }
    .admin-footer a { color: #dcfce7; transition: 0.2s; }
    .admin-footer a:hover { color: white; }
</style>
</head>
<body>

    <div class="sidebar shadow-sm">
        <h4 class="ps-2">
            <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="Logo" height="40" class="me-2"> 
            Tesco Food City <span class="fs-6 fw-normal text-muted ms-2">| Admin</span>
        </h4>
        
        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist">
            <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#dashboard">
                <i class="bi bi-grid-1x2-fill"></i> Dashboard
            </button>
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#products">
                <i class="bi bi-box-seam-fill"></i> Products
            </button>
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#orders">
                <i class="bi bi-truck"></i> Orders
            </button>
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#customers">
                <i class="bi bi-people-fill"></i> Customers
            </button>
        </div>
        <div class="mt-auto">
            <a href="{{ url_for('logout') }}" class="nav-link text-danger"><i class="bi bi-box-arrow-right"></i> Sign Out</a>
        </div>
    </div>

    <div class="main-content">
        
        <div class="d-flex justify-content-between align-items-center mb-5">
            <div>
                <h3 class="fw-bold text-dark">Admin Overview</h3>
                <p class="text-muted mb-0">Welcome back, Admin. Here's what's happening today.</p>
            </div>
            <div class="d-flex align-items-center gap-3">
                <div class="bg-white p-2 rounded-circle shadow-sm text-center" style="width:40px; height:40px;">
                    <i class="bi bi-bell"></i>
                </div>
                <div class="bg-white px-3 py-2 rounded-pill shadow-sm d-flex align-items-center gap-2">
                    <div class="bg-primary rounded-circle text-white d-flex align-items-center justify-content-center" style="width:30px; height:30px;">A</div>
                    <span class="fw-bold text-dark">Admin User</span>
                </div>
            </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} shadow-sm border-0 rounded-3 mb-4">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="tab-content" id="v-pills-tabContent">
            
            <div class="tab-pane fade show active" id="dashboard">
                <div class="row g-4">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div>
                                <p class="text-muted mb-1 font-monospace text-uppercase small">Total Revenue</p>
                                <h3 class="fw-bold text-dark mb-0">Rs. {{ stats.revenue }}</h3>
                            </div>
                            <div class="stat-icon bg-green-light"><i class="bi bi-currency-dollar"></i></div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div>
                                <p class="text-muted mb-1 font-monospace text-uppercase small">Total Orders</p>
                                <h3 class="fw-bold text-dark mb-0">{{ stats.orders }}</h3>
                            </div>
                            <div class="stat-icon bg-blue-light"><i class="bi bi-bag-check"></i></div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div>
                                <p class="text-muted mb-1 font-monospace text-uppercase small">Customers</p>
                                <h3 class="fw-bold text-dark mb-0">{{ stats.customers }}</h3>
                            </div>
                            <div class="stat-icon bg-purple-light"><i class="bi bi-people"></i></div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div>
                                <p class="text-muted mb-1 font-monospace text-uppercase small">Products</p>
                                <h3 class="fw-bold text-dark mb-0">{{ stats.products }}</h3>
                            </div>
                            <div class="stat-icon bg-orange-light"><i class="bi bi-box"></i></div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <h5 class="fw-bold mb-4">Recent Orders</h5>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Customer</th>
                                <th>Status</th>
                                <th>Amount</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders[:5] %}
                            <tr>
                                <td>#{{ order.id }}</td>
                                <td>{{ order.user_name }}</td>
                                <td>
                                    <span class="status-badge {% if order.status == 'Delivered' %}status-completed{% elif order.status == 'Cancelled' %}status-cancelled{% else %}status-pending{% endif %}">
                                        {{ order.status }}
                                    </span>
                                </td>
                                <td class="fw-bold">Rs. {{ order.total_price }}</td>
                                <td class="text-muted small">{{ order.date_ordered }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-pane fade" id="products">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="fw-bold">Product Inventory</h4>
                    <button class="btn btn-primary-custom text-white shadow-sm" data-bs-toggle="modal" data-bs-target="#addProductModal">
                        <i class="bi bi-plus-lg me-1"></i> Add Product
                    </button>
                </div>
                <div class="table-container mt-0">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Category</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in products %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="{{ product.image_url }}" style="width: 45px; height: 45px; object-fit: cover; border-radius: 8px; margin-right: 15px;">
                                        <span class="fw-bold">{{ product.name }}</span>
                                    </div>
                                </td>
                                <td>Rs. {{ product.price }}</td>
                                <td><span class="badge bg-light text-dark border">General</span></td>
                                <td class="text-end">
                                    <a href="{{ url_for('delete_product', id=product.id) }}" class="btn btn-sm btn-outline-danger border-0" onclick="return confirm('Delete this?')"><i class="bi bi-trash"></i></a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-pane fade" id="orders">
                <h4 class="fw-bold mb-4">All Orders</h4>
                <div class="table-container mt-0">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr>
                                <th>Order #</th>
                                <th>Customer Details</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status Update</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                            <tr>
                                <td class="fw-bold">#{{ order.id }}</td>
                                <td>
                                    <div class="fw-bold">{{ order.user_name }}</div>
                                    <div class="text-muted small"><i class="bi bi-geo-alt"></i> {{ order.address }}</div>
                                </td>
                                <td><small>{{ order.items }}</small></td>
                                <td class="fw-bold text-success">Rs. {{ order.total_price }}</td>
                                <td>
                                    <form action="{{ url_for('update_order_status', id=order.id) }}" method="POST" class="d-flex gap-2">
                                        <select name="status" class="form-select form-select-sm border-0 bg-light" style="width: 120px; font-weight: 500;">
                                            <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>Pending</option>
                                            <option value="Processing" {% if order.status == 'Processing' %}selected{% endif %}>Processing</option>
                                            <option value="Shipped" {% if order.status == 'Shipped' %}selected{% endif %}>Shipped</option>
                                            <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                                            <option value="Cancelled" {% if order.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                                        </select>
                                        <button type="submit" class="btn btn-sm btn-dark px-3 rounded-pill">Update</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="tab-pane fade" id="customers">
                <h4 class="fw-bold mb-4">Customer Database</h4>
                <div class="table-container mt-0">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User Profile</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                            <tr>
                                <td>{{ user.id }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="bg-light text-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 35px; height: 35px; font-weight: bold;">
                                            {{ user.username[0]|upper }}
                                        </div>
                                        <span class="fw-bold text-dark">{{ user.username }}</span>
                                    </div>
                                </td>
                                <td>{{ user.email }}</td>
                                <td>
                                    {% if user.role == 'admin' %}
                                        <span class="badge bg-primary">Admin</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Customer</span>
                                    {% endif %}
                                </td>
                                <td class="text-end">
                                    {% if user.role != 'admin' %}
                                    <a href="{{ url_for('delete_user', id=user.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Remove user?')">Remove</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

        <footer class="admin-footer">
            <div class="container text-center text-md-start">
                <div class="row">
                    <div class="col-md-4 mb-3 ps-md-4">
                        <h5 class="fw-bold d-flex align-items-center">
                            <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="Logo" height="40" class="me-2" style="border-radius: 8px;">
                            Tesco Food City
                        </h5>
                        <p class="small text-white-50">Crafting exceptional shopping experiences for our valued customers.</p>
                    </div>
                    <div class="col-md-4 mb-3">
                        <h5 class="fw-bold">Contact Us</h5>
                        <p class="small mb-1"><i class="bi bi-geo-alt-fill me-2"></i>380/F Leyland Junction, Panagoda</p>
                        <p class="small mb-1"><i class="bi bi-telephone-fill me-2"></i>0763659784</p>
                        <p class="small"><i class="bi bi-envelope-fill me-2"></i>TescoFoodCity@gmail.com</p>
                    </div>
                    <div class="col-md-4">
                        <h5 class="fw-bold">Quick Links</h5>
                        <ul class="list-unstyled small">
                            <li><a href="#" class="text-decoration-none">Privacy Policy</a></li>
                            <li><a href="#" class="text-decoration-none">Return Policy</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </footer>

    </div>

    <div class="modal fade" id="addProductModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
          <div class="modal-header border-0 pb-0">
            <h5 class="modal-title fw-bold">Add New Product</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body p-4">
            <form action="{{ url_for('add_product') }}" method="POST">
                <div class="mb-3">
                    <label class="form-label text-muted small fw-bold text-uppercase">Product Name</label>
                    <input type="text" name="name" class="form-control form-control-lg bg-light border-0" placeholder="e.g. Fresh Milk" required>
                </div>
                <div class="mb-3">
                    <label class="form-label text-muted small fw-bold text-uppercase">Price (Rs)</label>
                    <input type="number" name="price" class="form-control form-control-lg bg-light border-0" placeholder="0.00" required>
                </div>
                <div class="mb-4">
                    <label class="form-label text-muted small fw-bold text-uppercase">Image URL</label>
                    <input type="text" name="image_url" class="form-control form-control-lg bg-light border-0" placeholder="https://..." required>
                </div>
                <button type="submit" class="btn btn-primary-custom w-100 py-3">Create Product</button>
            </form>
          </div>
        </div>
      </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>